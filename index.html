<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Prayer Wall</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container">
  <h1>Prayer Wall üôè</h1>
  <button id="adminToggle" style="background:#333; margin-bottom:15px;">
  Admin Panel
  </button>

  
  <form id="prayerForm">
    <input type="text" id="name" placeholder="Your Name" required>
    <textarea id="intention" placeholder="Write your prayer..." required></textarea>
    <button type="submit">Submit Prayer</button>
  </form>

  <h2>Approved Prayers</h2>
  <div id="prayerList"></div>
  <hr>
<h2 id="adminTitle" style="display:none;">Pending Approvals</h2>
<div id="adminPanel" style="display:none;"></div>
<h2 style="display:none;" id="adminTitle">Pending Approvals</h2>
<div id="adminPanel" style="display:none;">
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, updateDoc, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBWx8qpiH1PmowRf0mql0MxiKqLhDfQlZ4",
  authDomain: "prayer-wall-c7a10.firebaseapp.com",
  projectId: "prayer-wall-c7a10",
  storageBucket: "prayer-wall-c7a10.firebasestorage.app",
  messagingSenderId: "234838865859",
  appId: "1:234838865859:web:6f42334b65329cf7beef76"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const form = document.getElementById("prayerForm");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value;
  const intention = document.getElementById("intention").value;

  await addDoc(collection(db, "prayers"), {
    name: name,
    intention: intention,
    date: new Date(),
    status: "pending"
  });

  alert("Your prayer has been submitted and is awaiting approval üôè");
  form.reset();
});

async function loadPrayers() {
  const prayerList = document.getElementById("prayerList");
  prayerList.innerHTML = "";

  const q = query(
    collection(db, "prayers"),
    where("status", "==", "approved"),
    orderBy("date", "desc")
  );

  const snapshot = await getDocs(q);

  snapshot.forEach((doc) => {
    const data = doc.data();
    prayerList.innerHTML += `
      <div class="prayer-card">
        <strong>${data.name}</strong>
        <p>${data.intention}</p>
      </div>
    `;
  });
}

loadPrayers();
  async function loadPending() {
  adminPanel.innerHTML = "";

  const q = query(
    collection(db, "prayers"),
    where("status", "==", "pending")
  );

  const snapshot = await getDocs(q);

  snapshot.forEach((docSnap) => {
    const data = docSnap.data();
    const id = docSnap.id;

    adminPanel.innerHTML += `
      <div class="prayer-card">
        <strong>${data.name}</strong>
        <p>${data.intention}</p>
        <button onclick="approvePrayer('${id}')">Approve</button>
        <button onclick="deletePrayer('${id}')">Delete</button>
      </div>
    `;
  });
  }
  const adminToggle = document.getElementById("adminToggle");
const adminPanel = document.getElementById("adminPanel");
const adminTitle = document.getElementById("adminTitle");

adminToggle.addEventListener("click", () => {
  const password = prompt("Enter Admin Password:");

  if (password === "1234") {
    adminPanel.style.display = "block";
    adminTitle.style.display = "block";
    loadPending();
  } else {
    alert("Wrong password");
  }
});
  window.approvePrayer = async function(id) {
  await updateDoc(doc(db, "prayers", id), {
    status: "approved"
  });
  loadPending();
  loadPrayers();
};

window.deletePrayer = async function(id) {
  await deleteDoc(doc(db, "prayers", id));
  loadPending();
};

</script>
</body>
</html>
